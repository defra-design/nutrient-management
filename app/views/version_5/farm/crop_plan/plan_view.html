{% extends "layouts/main.html" %}

{% block pageTitle %}
  Nutrient Application Plan – {{ serviceName }} – GOV.UK Prototype Kit
{% endblock %}

{% block beforeContent %}
{% include "/templates/signed-in.html" ignore missing %}
  {{ govukBreadcrumbs({
    items: [
      {
        text: "Oaktree Lane Farm",
        href: "../hub"
      },
      {
        text: "Plans and records",
        href: "../plans_records"
      },
      {
        text: "Harvest year " + data.oaktree_farm.planning_year
      }
    ]
  }) }}
{% endblock %}

{% block content %}

<div class="govuk-grid-row">

  {% set totalFields = 0 %}

  <div class="govuk-grid-column-two-thirds">
    {% if data.show_success_message == true %}
        {% include "./templates/success_message.html" ignore missing %}
      {% endif %}

      {% for group in data.cropGroupsV5 %}
        {% for field in group.fields %}
        {% set totalFields = totalFields + 1 %}
        {% endfor %}
      {% endfor %}
    </div>

    <div class="govuk-grid-column-full">

      <h1 id="main-title" class="govuk-heading-l">{{data.oaktree_farm.name}} plan {{data.oaktree_farm.planning_year}}</h1>
      <div class="margin-bottom-forty">
        <p class="govuk-body">Last updated: {{data.content.todays_date}}, there are {{totalFields}} fields in this plan</p>
        <p class="govuk-body"><a href="">Download, print, or export this plan</a></p>
      </div>

      <div class="govuk-tabs" data-module="govuk-tabs">

        <ul class="govuk-tabs__list">
          <li class="govuk-tabs__list-item govuk-tabs__list-item--selected">
            <a class="govuk-tabs__tab" href="#crops">
              Crops and fields
            </a>
          </li>
          <li class="govuk-tabs__list-item">
            <a class="govuk-tabs__tab" href="#organic">
              Organic material applications
            </a>
          </li>
          <li class="govuk-tabs__list-item">
            <a class="govuk-tabs__tab" href="#inorganic">
              Inorganic fertiliser applications
            </a>
          </li>
        </ul>

        {% set organics = false %}
        {% for group in data.allManureApplications %}
          {% if group.organic == true %}
            {% set organics = true %}
          {% endif %}
        {% endfor %}

        {% set inorganics = false %}
        {% if data.allFertiliserApplications.length > 0 %}
          {% set inorganics = true %}
        {% endif %}

      <!-- crops -->
      <div class="govuk-tabs__panel" id="crops">
        <h2 class="govuk-heading-m non-standard">Crops and fields</h2>
        <p class="govuk-body"><a href="../../add_crops/crop_group">Add a crop</a></p>
        <!-- <p class="govuk-body"><a href="">Enter excess rainfall for {{data.oaktree_farm.planning_year}}</a></p> -->
        <hr class="seperator_five">
          {% for group in data.cropGroupsV5 %}
            {% include "./templates/2024_crop_groups.html" ignore missing %}
          {% endfor %}  
      </div>

      <!-- manures -->
      <div class="govuk-tabs__panel govuk-tabs__panel--hidden" id="organic">
        <div class="margin-bottom-forty">
          <h2 class="govuk-heading-m non-standard">Organic material applications</h2>
          {% if organics == false %}
            <p class="govuk-body">You have no {{data.content.organic_term | lower}} applications planned.</p>
          {% endif %}
            <p class="govuk-body"><a href="v2manure_handler?manurejourney=multi">Add an {{data.content.organic_term | lower}} application to one or more fields</a></p>
        </div>
        {% if organics == true %}
          <hr class="seperator_five">
        {% endif %}
        <!-- manures -->
        <div class="margin-bottom-forty">
          {% if organics == true %}
            {% include "./templates/applications_tabs.html" ignore missing %}
          {% endif %}
        </div>
      </div>

      <!-- inorganics -->        
      <div class="govuk-tabs__panel govuk-tabs__panel--hidden" id="inorganic">
        <div class="margin-bottom-forty">
          <h2 class="govuk-heading-m non-standard">Inorganic fertiliser applications</h2>
          {% if inorganics == false %}
            <p class="govuk-body">You have no {{data.content.non_organic_term | lower}} applications planned.</p>
          {% endif %}
          <p class="govuk-body"><a href="v2fertiliser_handler?fertiliserjourney=multi">Add an {{data.content.non_organic_term | lower}} application to one or more fields</a></p>
        </div>
      
        {% if inorganics == true %}
          <p class="govuk-body">All amounts are per hectare.</p>
          <hr class="seperator_five">
        {% endif %}
      
        <div class="margin-bottom-forty">
          {% if inorganics == true %}
            <h2 class="govuk-heading-m">Nutrient totals from inorganic fertiliser for harvest year 2024</h2>
            <div class="margin-bottom-forty">
              {% include "./templates/2024_fertiliser_totals.html" ignore missing %}
            </div>
            <h2 class="govuk-heading-m">All inorganic fertiliser applications for harvest year 2024</h2>
            <p class="govuk-body"><a href="plan_view#inorganic">Sort by field name</a> <span>&nbsp;</span> or <span>&nbsp;</span> <a href="plan_view_date#inorganic">sort by application date</a></p>
            {% include "./templates/2024_fertiliser_table_v6.html" ignore missing %}
          {% endif %}
        </div>       
      </div>

    </div>

</div>

{% endblock %}